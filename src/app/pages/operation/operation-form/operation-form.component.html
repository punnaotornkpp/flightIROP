<div class="card">
  <div class="text-surface-900 dark:text-surface-0 block">
    <h2 class="text-2xl font-bold mb-6">
      Create Operation - {{ form.get("actionType")?.value }}
    </h2>

    <form [formGroup]="form">
      <div class="flex flex-col lg:flex-row gap-6">
        <div
          class="w-full lg:w-1/3 bg-white dark:bg-zinc-900 rounded shadow p-4"
        >
          <p-dropdown
            [options]="seasonOptions"
            formControlName="season"
            optionLabel="label"
            optionValue="code"
            placeholder="Select IATA Season"
            class="w-full mb-3"
          ></p-dropdown>

          <p-dropdown
            [options]="sourceTypeOptions"
            formControlName="sourceType"
            placeholder="Source Type"
            class="w-full mb-3"
          ></p-dropdown>

          <textarea
            rows="4"
            pInputText
            formControlName="message"
            placeholder="Message*"
            class="w-full mb-3"
          ></textarea>

          <p-multiselect
            [options]="noteOptions"
            formControlName="noteOptions"
            optionLabel="description"
            optionValue="code"
            placeholder="Select Notes"
            [display]="'chip'"
            class="w-full mb-3"
            [showToggleAll]="false"
          ></p-multiselect>
          <button
            pButton
            (click)="showFlightDialog = true"
            label="Add Flight"
            class="w-1/3 mt-4 float-end"
          ></button>
        </div>

        <div
          class="w-full lg:w-2/3 bg-white dark:bg-zinc-900 rounded shadow p-4 overflow-x-auto"
        >
          <p-table
            [value]="form.get('schedule.schedule')?.value"
            [paginator]="false"
            [rows]="5"
            class="p-datatable-sm"
            [scrollable]="true"
            scrollDirection="horizontal"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Flight Number</th>
                <th>Origin</th>
                <th>Destination</th>
                <th>Aircraft Type</th>
                <th>Departure Date</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-flight>
              <tr>
                <td>{{ flight.flightNumber }}</td>
                <td>{{ flight.origin }}</td>
                <td>{{ flight.destination }}</td>
                <td>{{ flight.aircraft }}</td>
                <td>{{ flight.departureDate }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="flex justify-between mt-6">
        <button
          pButton
          label="Back"
          class="p-button-outlined p-button-danger w-32"
          (click)="goBack()"
        ></button>

        <button
          pButton
          [label]="editId ? 'Edit' : 'Add'"
          class="p-button p-button-primary w-32"
          [loading]="isLoading"
          [disabled]="isLoading"
          (click)="onAdd()"
        ></button>
      </div>
    </form>
  </div>
  <p-dialog
    header="Search Flight Schedule"
    [(visible)]="showFlightDialog"
    [modal]="true"
    [style]="{ width: '60vw' }"
    [contentStyle]="{ padding: '1.5rem' }"
  >
    <div class="grid grid-cols-1 gap-4">
      <!-- Checkbox -->
      <div class="flex items-center gap-2 justify-end">
        <p-checkbox
          name="singleDate"
          [(ngModel)]="flightSearch.singleDate"
          binary="true"
          (onChange)="syncSingleDate()"
        ></p-checkbox>
        <label for="singleDate">Single Date</label>
      </div>

      <!-- Flight Number + Date Inputs -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
        <!-- Flight Number -->
        <div class="h-full">
          <label class="block mb-1">Flight Number</label>
          <p-inputgroup>
            <p-inputgroup-addon class="text-gray-500">DD</p-inputgroup-addon>
            <input
              pInputText
              class="w-full"
              [(ngModel)]="flightSearch.flightNumber"
              placeholder="Flight Number"
            />
          </p-inputgroup>
        </div>

        <!-- Start Date -->
        <div *ngIf="!flightSearch.singleDate" class="h-full">
          <label class="block mb-1">Start Date</label>
          <p-calendar
            [(ngModel)]="flightSearch.startDate"
            class="w-full"
            (onSelect)="onDateChange()"
          />
        </div>

        <!-- End Date -->
        <div *ngIf="!flightSearch.singleDate" class="h-full">
          <label class="block mb-1">End Date</label>
          <p-calendar [(ngModel)]="flightSearch.endDate" class="w-full" />
        </div>

        <!-- Single Date Mode (1 ช่องเต็มแนวนอน) -->
        <div *ngIf="flightSearch.singleDate">
          <label class="block mb-1">Start and End Date</label>
          <p-calendar
            [(ngModel)]="flightSearch.startDate"
            class="w-full"
            (onSelect)="onDateChange()"
          />
        </div>
      </div>

      <!-- Search Button -->
      <div class="text-end mt-2">
        <button
          pButton
          label="Search"
          icon="pi pi-search"
          class="p-button-primary"
          (click)="fetchFlightSchedule()"
        ></button>
      </div>
    </div>

    <div *ngIf="scheduleResult">
      <hr class="my-4" />
      <h3 class="text-lg font-semibold mb-2">Result:</h3>
      <pre class="bg-gray-100 p-3 rounded text-xs overflow-x-auto">{{
        scheduleResult | json
      }}</pre>
    </div>
  </p-dialog>
</div>
